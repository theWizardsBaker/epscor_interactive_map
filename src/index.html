<!doctype html>
<html class="no-js" lang="">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="x-ua-compatible" content="ie=edge">
		<title>EPSCoR Demo</title>
		<meta name="description" content="">
		<meta name="viewport" content="width=device-width, initial-scale=1">
	   
		<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css">
		<link rel="stylesheet" href="public/resources/css/main.css"> 
	</head>
	<body>
		<!--[if lt IE 10]>
			<p class="browserupgrade bg-warning">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
		<![endif]-->

		<nav id="navigation" class="navbar navbar-inverse">
			<div class="container-fluid">
				<div class="navbar-header">
					<a class="navbar-brand" href="#">
						EPSCoR Collaboration
					</a>
				</div>
				<ul class="navbar-text nav nav-pills">
					<li role="presentation" class="active" data-panel="map">
						<a href="#">Home</a>
					</li>
					<li role="presentation" data-panel="hyperspectral">
						<a href="#">Camera Imaging</a>
					</li>
					<li role="presentation" data-panel="drone">
						<a href="#">Drones</a>
					</li>
					<li role="presentation" data-panel="about">
						<a href="#">About</a>
					</li>
				</ul>
				<div class="navbar-text navbar-right">
					<img src="public/resources/images/logos/epscor_logo.png" alt="Missouri EPSCoR" class="nav-logo"/>
					<img src="public/resources/images/logos/transect_logo.png" alt="Missouri Transect" class="nav-logo"/>
					<img src="public/resources/images/logos/nsf_logo.png" alt="National Science Foundation" class="nav-logo"/>
				</div>
			</div>
		</nav>

		<section id="main-content" class="container-fluid">

			<div id="map" class="display-element">
				<div class="row">
					<section class="information col-md-12">
						<div class="panel panel-default">
							<div class="panel-body">
								<h3>Hyperspectral Imaging<small> an EPSCoR Colaboration</small></h3>
								<p>
									Bradford Farms drone flight images.
								</p>
								<!-- 
								<p>
									A summary of the imaging and how to use the page here. We can add animated comparisons by clicking below.
								</p>
								<ul>
									<li><a href="#">Compare Plots 1 and 3</a></li>
									<li><a href="#">Compare Plots 2 and 4</a></li>
									<li><a href="#">Compare Plots 1 and 2</a></li>
								</ul>
								 -->
							</div>	
						</div>
					</section>

					<div class="col-md-6">
						<section id="field-display" class="panel panel-default">
							<div class="panel-body">
								<!-- 								
								<div id="rgb-slider">	
									<h5 id="range-label">title</h5>
									<input type="range" id="rgb-range" value="1" min="1" max="33">
								</div> 
								-->
								<div id="field-display-selection"></div>
								<div id="field-selection"></div>
								<div id="rgb-field">
									<!-- <img src="public/resources/images/rgb_field.png" class="img-responsive rounded"/> -->
									<img src="" class="img-responsive rounded"/>
								</div>
							</div>
						</section>
					</div>
					<div class="col-md-6">
						<section id="selection-info" class="information">
						</section>
					</div>
				</div>
			</div>

			<div id="drone" class="display-element">
				<div class="row">
					<section id="drone-display" class="col-xs-12">
						<div class="panel panel-default">
							<div class="panel-body">
								<div class="row">
									<div class="col-sm-6">
										<figure>
											<img class="img-responsive" src="public/resources/images/drones/dji_s900.jpg">
										<figcaption>DJI S900</figcaption>
										</figure>
									</div>
									<div class="col-sm-6">
										<figure>
											<img class="img-responsive" src="public/resources/images/drones/dji_s1000.jpg">
											<figcaption>DJI S10000</figcaption>
										</figure>
									</div>
								</div>
								<div class="panel-content">
									<p>
										The drones used are DJI S900 and DJI S10000 models. More info can be provided here. Maybe a video of them in flight.
									</p>
								</div>
							</div>
						</div>
					</section>
				</div>
			</div>

			<div id="hyperspectral" class="display-element">

				<section class="panel panel-default">
					<div class="panel-body">
						<!-- Section to describe wavelength. How to read the diagrams, ect?  -->
					</div>
				</section>

				<section id="wavelengths" class="panel panel-default">
					<div class="panel-body row">
						<div class="col-sm-6">
							<h3>Red Green Blue</h3>
							<div class="panel-content">
								<figure class="row">
									<div class="col-xs-4 col-md-4 col-lg-3 vcenter">
										<img src="public/resources/images/field_snip_rgb.jpg" class="img-responsive spectrum">
									</div>
									<div class="col-xs-6 col-md-6 col-lg-5 vcenter">
										<img src="public/resources/images/rgb_spectral_graph.png" class="img-responsive spectrum">
									</div>
								</figure>
								The name of the model comes from the initials of the three additive primary colors, red, green and blue. The main purpose of the RGB color model is for the sensing, representation and display of images in electronic systems, such as televisions and computers, though it has also been used in conventional photography.
							</div>
						</div>

						<div class="col-sm-6">
							<h3>Normalized Difference Vegetation Index</h3>
							<div class="panel-content">
								<figure class="row">
									<div class="col-xs-4 col-md-4 col-lg-3 vcenter">
										<img src="public/resources/images/field_snip_ndvi.jpg" class="img-responsive spectrum">
									</div>
									<div class="col-xs-6 col-md-6 col-lg-5 vcenter">
										<img src="public/resources/images/spectral_graph.png" class="img-responsive spectrum ">
									</div>
								</figure>
								The Normalized Difference Vegetation Index (NDVI) is a reflectance index that calculates how healthy vegetation is based on a plantâ€™s absorption and reflectance of light in near-infrared and red regions. This index uses reflectance values at 670 and 800 nanometers (nm) and ranges from -1 to 1. The common range for vegetation is 0.2 to 0.8.
							</div>
						</div>

						<div class="col-sm-6">
							<h3>Modified Chlorophyll Absorption Ratio Index</h3>
							<div class="panel-content">
								<figure class="row">
									<div class="col-xs-5 col-md-5 col-lg-4 vcenter">
										<img src="public/resources/images/field_snip_mcari.png" class="img-responsive spectrum ">
									</div>
									<div class="col-xs-6 col-md-6 col-lg-5 vcenter">
										<img src="public/resources/images/spectral_graph.png" class="img-responsive spectrum ">
									</div>
								</figure>
								The Modified Chlorophyll Absorption Ratio Index (MCARI) indicates the relative chlorophyll abundance of vegetation. MCARI minimizes soil background effects on vegetation reflectance.
							</div>
						</div>

						<div class="col-sm-6">
							<h3>Photochemical Reflectance Index</h3>
							<div class="panel-content">
								<figure class="row">
									<div class="col-xs-4 col-md-4 col-lg-3 vcenter">
										<img src="public/resources/images/field_snip_pri.jpg" class="img-responsive spectrum ">
									</div>
									<div class="col-xs-6 col-md-6 col-lg-5 vcenter">
										<img src="public/resources/images/spectral_graph.png" class="img-responsive spectrum ">
									</div>
								</figure>
								The Photochemical Reflectance Index (PRI) is an index that measures changes in carotenoid pigments that respond quickly to stress. These pigments are great indicators of how efficiently plants use light, so this index is useful for quickly detecting plant stress. PRI uses 531 nm and 570 nm. Values range from -1 to 1, with green vegetation somewhere between -0.2 to 0.2.
							</div>
						</div>

						<div class="col-sm-6">
							<h3>Hyperspectral</h3>
							<div class="panel-content">
								<figure class="row">
									<div class="col-xs-4 col-md-4 col-lg-3 vcenter">
										<img src="public/resources/images/field_snip_hs.jpg" class="img-responsive spectrum ">
									</div>
									<div class="col-xs-6 col-md-6 col-lg-5 vcenter">
										<img src="public/resources/images/spectral_graph.png" class="img-responsive spectrum ">
									</div>
								</figure>
								Hyperspectral (HS) imaging collects and processes information from across the electromagnetic spectrum. The goal of hyperspectral imaging is to obtain the spectrum for each pixel in the image of a scene, with the purpose of finding objects, identifying materials, or detecting processes.
							</div>
						</div>

					</div>
				</section>

			</div>

			<div id="about" class="display-element">
				<div class="panel panel-default">
					
				</div>
			</div>
		</section>


		<script src="http://code.jquery.com/jquery-3.0.0.min.js" integrity="sha256-JmvOoLtYsmqlsWxa7mDSLMwa6dZ9rrIdtrrVYRnDRH0=" crossorigin="anonymous"></script>
		<script src="http://code.jquery.com/ui/1.12.1/jquery-ui.min.js" integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU=" crossorigin="anonymous"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.3/modernizr.min.js"></script>
		<script src="public/resources/js/template7.js"></script>
		<script src="public/resources/js/data.json"></script>


		<script id="spectrum_button" type="text/template7">
			<button class="btn btn-default spectrum-select {{isActive @index @root.selection}}" value="{{@index}}" type="button">{{type}}</button>
		</script>

		<script id="rgb_selector_template" type="text/template7">
			<ul id="rgb-field-selector" class="nav nav-tabs">
				{{#each this}}
					<li role="presentation" class="{{#if @first}}active{{/if}}"><a href="#" image-path="public/resources/images/rgb_fields/{{image}}">{{title}}</a></li>
				{{/each}}
			</ul>
		</script>

		<script id="plot_template" type="text/template7">
			<div class="table-responsive">          
				<table class="table">
					<tbody>
						{{#buildTable grid plots}}
							<span class="glyphicon glyphicon-record" aria-hidden="true"></span>
							<span class="plot-title">{{title}}</span>
							<div class="plot-delim"></div>
						{{/buildTable}}
					</tbody>
				</table>
			</div>
		</script>

		<script id="spectrum_template" type="text/template7">
				<div id="{{id}}" class="panel panel-default info-window">

					<div class="panel-heading">
						<button type="button" class="close" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h3 class="panel-title">{{title}}</h3>
					</div>

					<div class="color-banding" style="background: {{color}};"></div>

					<div class="container-fluid panel-body">

						<div class="row info-display">

							<div class="col-xs-12 col-sm-2 hidden-xs vcenter">
								<div class="input-group wavelength_selection">
									<div class="btn-group-vertical" role="group" aria-label="..." >
									{{#each spectrum}}
										{{> "spectrumButton"}}
									{{/each}}
									</div>
								</div>
							</div><!--

						 --><div class="col-xs-12 visible-xs small-control">
								<div class="input-group wavelength_selection">
									<div class="btn-group" role="group" aria-label="..." >								
									{{#each spectrum}}
										{{> "spectrumButton"}}
									{{/each}}
									</div>
								</div>
							</div><!--	

						 --><div class="col-xs-5 col-sm-5 vcenter drone-image">
								<figure>
									<div>
										{{#each spectrum}}
											<img src="public/resources/images/spectrum/{{camera_image}}" class="img-responsive spectrum {{isActive @index @root.selection}}"/>
										{{/each}}
									</div>
								</figure>
							</div><!--

						 --><div class="col-xs-7 col-sm-5 vcenter ">
								<figure>
									<div>
										{{#each spectrum}}
											<img src="public/resources/images/spectrum/{{graph_image}}" class="img-responsive spectrum {{isActive @index @root.selection}}" />
										{{/each}}
									</div>
								</figure>
							</div>

						</div>

					</div>

					<div class="panel-body panel-content">
						{{#each spectrum}}
							<p class="descr spectrum {{isActive @index @root.selection}}">{{description}}</p>
						{{/each}}
					</div>

				</div>
		</script>

		<script type="text/javascript">

			Template7.registerHelper('isActive', function (str1, str2, options) {
				return ( str1 == str2 ? 'active' : '' );
			});

			Template7.registerHelper('buildTable', function (dimensions, plots, options) {
				var output = "";
				// walk the row
				for(var row = 0; row < dimensions[0]; row++){
					output += "<tr>";
					// walk the column
					for(var col = 0; col < dimensions[1]; col++){
						var table_data = "";
						// if we have a plot point, print it and then remove it from our array
						for(var point = 0; point < plots.length; point++){
							if(plots[point].grid_location[0] == row && plots[point].grid_location[1] == col){
								// wrap the line in a td statement
								table_data += "<td data-id='" + plots[point].id + "' class='content-region'>";
								table_data += options.fn(plots[point], options.data);
								table_data += "</td>"
							}
						}
						output += (table_data.length > 0) ? table_data : "<td></td>";
					}
					output += "</tr>";
				}
				return output;
			});

			Template7.registerPartial('spectrumButton', $('#spectrum_button').html());

			Template7.registerPartial('tablePlot', $('#plot_table_element').html());

			var select_content = function(new_content){
				$('#main-content').fadeOut("fast", function() {
					$(this).children('div.display-element').css('display', 'none');
					$(new_content).css('display', 'block');
					$(this).fadeIn();
				});
			};

			
			$(document).ready(function() {

				/*

				startup 
				
				*/

				// colab_obj comes from the .json file. It is the name of the variable
				// get the html
				var spectrum_template = $("#spectrum_template").html();
				// compile the plot
				var compiled_spectrum_template = Template7.compile(spectrum_template);

				// get the html for the plot
				var plot_template = $("#plot_template").html();
				// compile the plotting table
				var compiled_plot_template = Template7.compile(plot_template);
				// add the generated html to the page
				$('#field-selection').html(compiled_plot_template(colab_obj));

				select_content($('#map'));
				

				// get html
				var field_selector_template = $("#rgb_selector_template").html();
				// compile it
				var compiled_field_selector_template = Template7.compile(field_selector_template);
				// add html
				$('#field-display-selection').html(compiled_field_selector_template(colab_obj.fields));

				/*

				helpers

				*/

				var find_plot = function(plots, id){
					return $.grep(plots, function(elm, ind){ return elm.id == id; })[0];
				};

				var select_spectrum = function(plot, spectrum) {
					// set selected element
					plot.selection = spectrum || 0;
					return compiled_spectrum_template(plot);
				};

				/*
				
				event handlers

				*/

				$('#navigation ul.nav').on('click', 'li', function() {
					$(this).addClass('active').siblings().removeClass('active');
					select_content( $("#" + $(this).data('panel')) );
				});

				$('#selection-info')
				.on('click', 'button.spectrum-select', function(){
					// if we didn't click on the currently selected
					if($(this).not('.selected')){
						// get the parent panel
						var spectrum_panel = $(this).parents('div.panel.info-window');
						// find the plot element
						var plot = find_plot(colab_obj.plots, spectrum_panel.attr('id'));
						// get the template and replace it
						$(spectrum_panel).replaceWith(select_spectrum(plot, $(this).attr('value')));
					}
				})
				.on('click', 'button.close', function() {
					// get that ther' id
					var parent_panel_id = $(this).parents('div.panel.info-window').attr('id');
					// and click the TD element
					$('td.content-region.selected').filter("[data-id=" + parent_panel_id + "]").click();
				})
				.sortable({
					opacity: 0.8,
					handle: ".panel-heading"
				});

				// select the RGB image
				$( "#rgb-field-selector" )
				.on('click', 'li', function() {

					$(this).siblings().removeClass('active');
					$(this).addClass('active');

					var image_path = $(this).find('a').attr("image-path");

					$('#rgb-field img').attr("src", image_path);

				});

				// mouse and click elements for the field items
				$('#field-display')
				.on('mouseover', 'td.content-region', function() {
					$(this).find('div.plot-delim').not(".selected").addClass('hover');
				})
				.on('mouseout', 'td.content-region', function() {
					$(this).find('div.plot-delim').removeClass('hover');
				})
				.on('click', 'td.content-region', function(){
					// get the plot's delimiters and select it
					$(this).toggleClass('selected').find('div.plot-delim').toggleClass('selected');
					//if we just selected it, add the spectrum
					if($(this).hasClass('selected')){
						// find the plot element
						var plot = find_plot(colab_obj.plots, $(this).data('id'));
						// set the selection colors
						$(this).css( 'color', plot.color ).find('div.plot-delim').css('border-color',plot.color);
						// append a new spectrum window
						$('#selection-info').append(select_spectrum(plot));
					} else {
						// set our colors back to white
						$(this).css( 'color', 'white' ).find('div.plot-delim').css('border-color','white');
						// remove the element
						var id = $(this).data('id');
						// remove that guy
						$('#' + id).remove();
					}
				});


				/*

					Startup Functions

				*/

				// select first element 
				$('#field-display-selection ul').children('li').first().click();

			});
		</script>

	</body>
</html>